
---
- name: build an image by running ansible in a container
  hosts: myhost
  connection: local

  tasks:

    - name: install docker-py
      pip: 
        name: docker-py 
        state: present

    - name: upload site directory to docker host
      synchronize: 
        src: nginx-node
        dest: /tmp

    - name: build docker image
      docker_image:
        name: webserver
        tag: ex1
        path: /tmp/nginx-node
        state: present

    - name: run nginx with sample node app and leave it running
      docker_container:
        name: webserver
        image: "webserver:ex1"
        ports:
          - "80:80"
        detach: true